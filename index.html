<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Transmitir Tela</title>
<style>
body{margin:0;background:#111;color:#eee;font-family:Arial;text-align:center}
button{font-size:22px;padding:14px 28px;margin-top:40vh;background:#007aff;border:none;color:#fff;border-radius:8px}
</style>
</head>
<body>
<button id="btn">Transmitir Minha Tela</button>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// Config do Firebase com seu database
const firebaseConfig = {
  apiKey: "AIzaSyD6vf58vpJDL444wF7XkzF7kYPiVU73pVY",
  authDomain: "screenlink-7bbef.firebaseapp.com",
  databaseURL: "https://screenlink-7bbef-default-rtdb.europe-west1.firebasedatabase.app/",
  projectId: "screenlink-7bbef",
  storageBucket: "screenlink-7bbef.firebasestorage.app",
  messagingSenderId: "854919839518",
  appId: "1:854919839518:web:a91e2cc425f34e0290530f",
  measurementId: "G-SDVTFWVFF5"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Pega ID da sala do link
const urlParams = new URLSearchParams(window.location.search);
const roomId = urlParams.get('room') || prompt("Informe o ID da sala");

document.getElementById('btn').onclick = async () => {
  const stream = await navigator.mediaDevices.getDisplayMedia({video:true,audio:true});
  const pc = new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});

  stream.getTracks().forEach(track => pc.addTrack(track, stream));

  pc.onicecandidate = e => {
    if (e.candidate) return;
    db.ref('rooms/' + roomId + '/offer').set(pc.localDescription.toJSON());
  };

  db.ref('rooms/' + roomId + '/answer').on('value', async snapshot => {
    const answer = snapshot.val();
    if (answer) await pc.setRemoteDescription(answer);
  });

  const offer = await pc.createOffer();
  await pc.setLocalDescription(offer);
};
</script>
</body>
</html>
