<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Receber Tela</title>
<style>
body {
    background: #000;
    color: white;
    margin: 0;
    font-family: Arial;
    text-align: center;
}
video {
    width: 100vw;
    height: 100vh;
    object-fit: contain;
    background: #111;
}
</style>
</head>
<body>

<h2>Aguardando transmissão…</h2>
<video id="remoteVideo" autoplay playsinline></video>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyD6vf58vpJDL444wF7XkzF7kYPiVU73pVY",
  authDomain: "screenlink-7bbef.firebaseapp.com",
  databaseURL: "https://screenlink-7bbef-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "screenlink-7bbef",
  storageBucket: "screenlink-7bbef.firebasestorage.app",
  messagingSenderId: "854919839518",
  appId: "1:854919839518:web:a91e2cc425f34e0290530f",
  measurementId: "G-SDVTFWVFF5"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const room = "ROOM123";

const pc = new RTCPeerConnection();

pc.ontrack = (event) => {
    document.getElementById("remoteVideo").srcObject = event.streams[0];
};

async function init() {
    const offerRef = ref(db, "rooms/" + room + "/offer");
    const answerRef = ref(db, "rooms/" + room + "/answer");
    const iceRef = ref(db, "rooms/" + room + "/pc_ice");

    onValue(offerRef, async (snap) => {
        const offer = snap.val();
        if (!offer) return;

        await pc.setRemoteDescription(new RTCSessionDescription(offer));

        const answer = await pc.createAnswer();
        await pc.setLocalDescription(answer);

        set(answerRef, answer);
    });

    onValue(iceRef, async (snap) => {
        const candidates = snap.val();
        if (!candidates) return;

        for (const c of candidates) {
            try { await pc.addIceCandidate(c); } catch {}
        }
    });

    pc.onicecandidate = (event) => {
        if (event.candidate) {
            set(iceRef, [...(iceRef._cache || []), event.candidate.toJSON()]);
        }
    };
}

init();
</script>
</body>
</html>

