<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Receber Tela</title>
<style>
body{margin:0;background:#000;color:#fff;text-align:center;font-family:Arial;}
video{width:100%;height:80vh;margin-top:10px;}
#qrcode{margin-top:10px;}
</style>
</head>
<body>
<h2>Escaneie o QR para conectar o iPhone</h2>
<div id="qrcode"></div>
<video id="v" autoplay playsinline></video>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

<script>
// Config do Firebase já com seus valores
const firebaseConfig = {
  apiKey: "AIzaSyD6vf58vpJDL444wF7XkzF7kYPiVU73pVY",
  authDomain: "screenlink-7bbef.firebaseapp.com",
  databaseURL: "https://screenlink-7bbef-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "screenlink-7bbef",
  storageBucket: "screenlink-7bbef.firebasestorage.app",
  messagingSenderId: "854919839518",
  appId: "1:854919839518:web:a91e2cc425f34e0290530f",
  measurementId: "G-SDVTFWVFF5"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Gera ID de sala aleatório
const roomId = Math.random().toString(36).substring(2,8).toUpperCase();

// Cria link para iPhone
const baseURL = window.location.origin + "/index.html?room=" + roomId;
QRCode.toCanvas(document.getElementById('qrcode'), baseURL, function (error) {
  if (error) console.error(error);
});

const pc = new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});
pc.ontrack = e => document.getElementById('v').srcObject = e.streams[0];

// Recebe offer do iPhone e envia answer
db.ref('rooms/' + roomId + '/offer').on('value', async snapshot => {
  const offer = snapshot.val();
  if (!offer) return;
  await pc.setRemoteDescription(offer);
  const answer = await pc.createAnswer();
  await pc.setLocalDescription(answer);
  db.ref('rooms/' + roomId + '/answer').set(pc.localDescription.toJSON());
});
</script>
</body>
</html>
