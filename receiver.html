<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Receber Tela</title>
<style>
body{margin:0;background:#000}
video{width:100%;height:100vh;object-fit:contain;}
</style>
</head>
<body>

<video id="v" autoplay playsinline></video>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<script>
// ---- CONFIG DO FIREBASE ----
const firebaseConfig = {
    apiKey: "AIzaSyD6vf58vpJDL444wF7XkzF7kYPiVU73pVY",
    authDomain: "screenlink-7bbef.firebaseapp.com",
    databaseURL: "https://screenlink-7bbef-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "screenlink-7bbef",
    storageBucket: "screenlink-7bbef.firebasestorage.app",
    messagingSenderId: "854919839518",
    appId: "1:854919839518:web:a91e2cc425f34e0290530f",
    measurementId: "G-SDVTFWVFF5"
};

// Inicializa Firebase
const app = firebase.initializeApp(firebaseConfig);
const db = firebase.database();

(async () => {

    const pc = new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});
    const video = document.getElementById("v");

    pc.ontrack = e => {
        video.srcObject = e.streams[0];
    };

    // Pega o código da sala automaticamente via prompt
    const roomId = prompt("Cole o código da sala (QR do iPhone):");
    if (!roomId) {
        alert("Nenhuma sala informada");
        return;
    }

    // Escuta a oferta do iPhone
    db.ref("rooms/" + roomId + "/offer").once("value").then(snap => {
        if (!snap.exists()) {
            alert("Oferta não encontrada. Verifique o QR code.");
            return;
        }
        const offer = JSON.parse(atob(snap.val()));
        pc.setRemoteDescription(offer).then(async () => {
            const answer = await pc.createAnswer();
            await pc.setLocalDescription(answer);
            // Envia a resposta para o Firebase
            db.ref("rooms/" + roomId + "/answer").set(btoa(JSON.stringify(answer)));
        });
    });

})();
</script>

</body>
</html>
